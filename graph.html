<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Stats Chart</title>
    <style>
        body {
            font-family: system-ui;
            background-color: #234;
            color: white;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
</head>
<body>
    <h1>Stats about the messages</h1>
    <h2>Spam/nonspam over amount capitalized</h2>
    <canvas id="capitalizationChart"></canvas>
    <h2>Spam/nonspam over amount of tokens</h2>
    <canvas id="tokenCountChart"></canvas>
    <script>
        var capitalizationChart = document.getElementById("capitalizationChart");
        var tokenCountChart = document.getElementById("tokenCountChart");
        var capitalizationChartData = {
            labels: [],
            datasets: [{
                label: "Trading",
                data: [],
                backgroundColor: "rgba(255, 128, 64, 0.5)",
                borderColor: "rgba(255, 128, 64, 0.5)",
                borderWidth: 1
            }, {
                label: "Advertising",
                data: [],
                backgroundColor: "rgba(64, 128, 255, 0.5)",
                borderColor: "rgba(64, 128, 255, 0.5)",
                borderWidth: 1
            }, {
                label: "Non-spam",
                data: [],
                backgroundColor: "rgba(64, 255, 32, 0.5)",
                borderColor: "rgba(64, 255, 32, 0.5)",
                borderWidth: 1
            }]
        };
        var tokenCountChartData = {
            labels: [],
            datasets: [{
                label: "Trading",
                data: [],
                backgroundColor: "rgba(255, 128, 64, 0.5)",
                borderColor: "rgba(255, 128, 64, 0.5)",
                borderWidth: 1
            }, {
                label: "Advertising",
                data: [],
                backgroundColor: "rgba(64, 128, 255, 0.5)",
                borderColor: "rgba(64, 128, 255, 0.5)",
                borderWidth: 1
            }, {
                label: "Non-spam",
                data: [],
                backgroundColor: "rgba(64, 255, 32, 0.5)",
                borderColor: "rgba(64, 255, 32, 0.5)",
                borderWidth: 1
            }]
        };
        var capitalizationChartOptions = {
            title: {
                display: true,
                text: "Spam/nonspam over amount capitalized"
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        };
        var tokenCountChartOptions = {
            title: {
                display: true,
                text: "Spam/nonspam over amount of tokens"
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        };
        var capitalizationChart = new Chart(capitalizationChart, {
            type: "bar",
            data: capitalizationChartData,
            options: capitalizationChartOptions
        });
        var tokenCountChart = new Chart(tokenCountChart, {
            type: "bar",
            data: tokenCountChartData,
            options: tokenCountChartOptions
        });
        const tokenize = str => {
            return str.normalize("NFKC").replace(/[^\w\s]/g, " ").toLowerCase().trim().split(/\s+/);
        }
        fetch("/messages.json")
            .then(resp => resp.json())
            .then(messages => {
                for (message in messages) {
                    let classification = ["b", "c", ""][messages[message]];
                    let capitalizedCharacters = message.replace(/[^A-Z]/g, "").length;
                    let totalCharacters = message.replace(/[^a-zA-Z]/g, "").length;
                    let capitalizedPercentage = capitalizedCharacters / totalCharacters;
                    let tokens = tokenize(message);
                    let tokenCount = tokens.length;
                    capitalizationChartData.labels.push(classification);
                    capitalizationChartData.datasets[classification].data.push(capitalizedPercentage.toFixed(1));
                }
            });
    </script>
</body>
</html>
