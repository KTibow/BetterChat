<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metadata Analysis Test</title>
    <style>
        body {
            font-family: system-ui;
            background-color: #234;
            color: white;
        }
        td, th {
            background: #345;
            padding: 0.5em;
            margin: 0.5em;
        }
    </style>
</head>
<body>
    <h1>Metadata Analysis Test</h1>
    <table>
        <tr>
            <th>Message</th>
            <th>Is spam</th>
            <th>Tokens</th>
            <th>Metadata</th>
            <th>Discriminatory</th>
        </tr>
    </table>
    <script>
        var messages = {"[VIP] KTibow: i said it wout underscore":"","crvnau: lol":"","AppleJuice001: rip":"","upset_oval: no":"","[MVP+] lokkee: why are you so toxic?":"","[MVP+] xArrowverse: to purchase":"","[MVP+] OZone_: *Debates life*":"","upset_oval: do u want this back too?":"","[VIP] KTibow: anyone have cliffside veins tita?":"","Hy4na: a billionare just destroyed bazaar":"","DeniableTerrorK: 30fps in the forest":"","[VIP] DiamondBlaze2010: called":"","[MVP+] zero_buck3ts: sounds good?":"","[VIP] KTibow: also use optifine":"","XvortexXPVP: can i have 50k":"","[VIP] Tygo07: lol":"","[MVP+] randomFoxx: its disabled lol":"","[MVP+] NyanGod: there was a dupe?":"","[VIP] synodnogi: anyone quitting skyblock? \/p me4":"b","[VIP] Ponczex: sell me good sword 6\/7 k damage for 800k$":"b","[MVP++] avokadoZ: i need 4m for flower of truth":"b","[VIP+] _drqgon: BUYING T11 lapis minions \/visit me BUYING T11 lapis minions \/visit me":"b","[VIP] ZombieStarWars: SELLING LEVEL 50 LEG SKELETON HORSE FOR 3.9M 100K LOWER THAN CHEAPEST BIN \/P ME":"b","[MVP++] _Atlqs: 14m profit on my ah ending now but it quick!!!!!! OOF o\/\/\/\/\/\/\/\/\/\/\/\/\/":"b","[VIP] Rinsku: <<BEST PLAC3 T0 BUY CO!INS>> kirapog com":"c","Dachipro123: hi":"","[VIP+] cdktx2: another white block will spawn":"","[VIP] SusShady22: has anyone got spare":"","[MVP+] Exquisitly: gg":"","[VIP] Dr_Cactacombs: damm in":"","[VIP] Cola_Zero123: effecient miner":"","[VIP] Pndal: i was gonna bid hiegher":"","cf52: it hard":"","[VIP+] BennyQuick: nice":"","[MVP+] xArrowverse: f":"","DeniableTerrorK: k ignore me typing":"","thumbsuplarry: from where":"","[MVP+] RockZorg: eu":"","[VIP] KTibow: this is where all of last night's luck went into":"","[MVP+] thorax_the_great: so hypothetically":"","[VIP+] bysy: wya":"","[VIP] DiamondBlaze2010: crazy wit it":"","[VIP] KTibow: cause it has +1 forge spot twice":"","[MVP+] Achelous5: if you need it for comm take any titanium I mine, just gotta ask me lol":"","[VIP] KTibow: imma fish":"","[VIP] KTibow: is that a cobble macro?":"","[MVP++] SoB_MoB: lowballing 1b purse no tools minions books or pets 10m+ items only":"b","LouCypher_69: buy cheap lions on my ah":"b","[VIP+] VosAlludis: GET EASY 12M PER HOUR: danpog com":"c","[MVP+] Minemon: Its a free 1 million coins":"","NovatusDraconis: never played that":"","ChewyMermaid427: anyone selling snow minion?":"","[VIP] KTibow: welp":"","gregorypeck: can ihave one of the minions pls?":"","QueenSeaTurtle: thank you!":"","[MVP+] RileyMC1234: this is why nature is dumb":"","MaxTheAxe123: or for how much do u want":"","Hollister2612: im new":"","upset_oval: how":"","[VIP] KTibow: da hecc is this chat":"","[VIP] KTibow: how do you get to ice bridge from forge":"","[MVP+] Dreees: omw too":"","[VIP] ItSoviet: 3m":"","[VIP] osl__: keep it":"","vevethedestroyer: i wamt*":"","[MVP+] PlishPlishFish: protip: if you don't spend money you get a big bank balance":"","[MVP+] GDPikls: i am in need of around 250k for FoT, can anyone help? i am at bank if u can":"b","[MVP+] sushisonline: SELLING max juju shortbow 18m \/p me":"b","[VIP] kleeNIX5204: buy on my ah rn, amazing deals and flips, jungle pic = 7m p hour!!!":"b","[VIP] SwoyyyS: selling Spiritual Juju Shortbow 5 star all hot potato books and soul eater 3 and some maxed enchants for 35m \/p me":"b","[VIP] Carcol: 8m at ah(It's not tier 12, does not have loving":"b","[VIP] yNicxlws: <<BEST PLAC3 T0 BUY CO!INS>> kirapog com":"c","[VIP+] Gnurak: G3T PA1D CO!NS 3ASILY: kirapog com":"c","BeyondBlank: coinempires \uff43\uff4f\uff4d fre3 Co1ns":"c","[VIP] Twoffi: whats the best fishing pet":"","[MVP] CarbonAlligator: u can be afk":"","[MVP+] Chungus_ATT: oh lol":"","[VIP] JoHooga171: SRY":"","[MVP] sytc: its sooo much better":"","DeniableTerrorK: wut":"","SamuraiMCLive: selling*":"","[VIP] KahlKahlkopf: like in furfsky reborn is in active texture packs alr":"","[MVP+] YoHomieBob: to get young":"","RoiL_: in the building straight from where you spawn":"","[MVP] sytc: u wil":"","[VIP] KTibow: i gtg":"","JohnBoy6X6: how manney days till i de":"","[VIP] kickoff50: thank you DrEnstein":"","[VIP] Namejs11: ktibow where are you":"","[VIP] JordanAF: rip":"","[VIP] KTibow: but bazaar closed rn":"","[MVP+] sussytechno69: 850k aote ult wise 3 on my ah (worth 1.4 mil)":"b","Gizmick: TOP #99 guild \/g join Lost in Dungeons reqs: cata 30 skill avg 35 slayers 7 6 6 4 or 3.5k weight bypass":"b","[MVP+] monke_qt: giving away cookeis !!!!!! ( NOT BOOSTER ) \/visit monke_qt":"b","[VIP] Indefinate: best deal juju on ah with overload 4":"b","PoggiesMomento: Cheap 2 star shadow assasin leggings on my ah for 3.5 mil":"b","[VIP] KTibow: im making a mod and i need to test something, can you guys submit a bid on \/ah Coder_Ultimate":"b","LucNLD: G1veaway of 100m coinskyblock \uff43\uff4f\uff4d":"c","[VIP+] EasyGoingGoat: C01NS BUY sbhcoins. \uff43\uff4f\uff4d":"c"};
        const tokenize = str => {
            return str.normalize("NFKC").replace(/[^\w\s]/g, " ").toLowerCase().trim().split(/\s+/);
        }
        fetch("/messages.json")
            .then(response => response.json())
            .then(data => {
                const findTokenWeighting = token => {
                    // Probability:
                    // percentage of spams that contain the token
                    // over
                    // number of non-spams that contain the token + that number
                    var spamCount = 0;
                    var totalSpams = 0;
                    var nonSpamCount = 0;
                    var totalNonSpams = 0;
                    for (message in data) {
                        let messageContent = message.split(":").splice(1).join(":");
                        let messageTokens = tokenize(messageContent);
                        if (message.split(":")[0].includes("[VIP")) {
                            if (message.split(":")[0].includes("+")) {
                                messageTokens.push("*VIP+");
                            } else {
                                messageTokens.push("*VIP");
                            }
                        } else if (message.split(":")[0].includes("[MVP")) {
                            if (message.split(":")[0].includes("++")) {
                                messageTokens.push("*MVP++");
                            } else if (message.split(":")[0].includes("+")) {
                                messageTokens.push("*MVP+");
                            } else {
                                messageTokens.push("*MVP");
                            }
                        } else {
                            messageTokens.push("*NO");
                        }
                        if (message.replace(/[^a-z]/g, "").length != message.replace(/[^a-zA-Z]/g, "").length) {
                            messageTokens.push("*UPPER");
                        } else {
                            messageTokens.push("*LOWER");
                        }
                        messageTokens.push("*PUNC" + message.replace(/[^a-zA-Z ]/g, "").length);
                        messageTokens.push("*TOKEN" + messageTokens.length);
                        messageTokens.push("*SENDERCAPS" + message.split(":")[0].replace(/[^A-Z]/g, "").length);
                        if (data[message] == "b" || data[message] == "c") {
                            totalSpams++;
                            if (messageTokens.includes(token)) {
                                spamCount++;
                            }
                        } else if (data[message] == "") {
                            totalNonSpams++;
                            if (messageTokens.includes(token)) {
                                nonSpamCount++;
                            }
                        }
                    }
                    var weight = (spamCount / totalSpams) / (nonSpamCount / totalNonSpams + spamCount / totalSpams);
                    weight = Math.max(weight, 0.01);
                    weight = Math.min(weight, 0.99);
                    return weight;
                }
                const findChatWeighting = tokens => {
                    let allWeights = [];
                    for (token of tokens) {
                        let weighting = findTokenWeighting(token);
                        if (!weighting) continue;
                        allWeights.push(weighting);
                    }
                    let totalNumerator = allWeights.reduce((a, b) => a * b, 1);
                    allWeights = allWeights.map(n => {return 1 - n});
                    let totalDenominator = allWeights.reduce((a, b) => a * b, 1);
                    totalDenominator += totalNumerator;
                    return totalNumerator / totalDenominator;
                }
                console.log(findTokenWeighting, findChatWeighting);
                let allMessages = [];
                for (message in data) {
                    let messageContent = message.split(":").splice(1).join(":");
                    let messageTokens = tokenize(messageContent);
                    let metaTokens = JSON.parse(JSON.stringify(messageTokens));
                    if (message.replace(/[^a-z]/g, "").length != message.replace(/[^a-zA-Z]/g, "").length) {
                        metaTokens.push("*UPPER");
                    } else {
                        metaTokens.push("*LOWER");
                    }
                    metaTokens.push("*PUNC" + message.replace(/[^a-zA-Z ]/g, "").length);
                    metaTokens.push("*TOKEN" + messageTokens.length);
                    let discrimTokens = JSON.parse(JSON.stringify(metaTokens));
                    if (message.split(":")[0].includes("[VIP")) {
                        if (message.split(":")[0].includes("+")) {
                            discrimTokens.push("*VIP+");
                        } else {
                            discrimTokens.push("*VIP");
                        }
                    } else if (message.split(":")[0].includes("[MVP")) {
                        if (message.split(":")[0].includes("++")) {
                            discrimTokens.push("*MVP++");
                        } else if (message.split(":")[0].includes("+")) {
                            discrimTokens.push("*MVP+");
                        } else {
                            discrimTokens.push("*MVP");
                        }
                    } else {
                        discrimTokens.push("*NO");
                    }
                    discrimTokens.push("*SENDERCAPS" + message.split(":")[0].replace(/[^A-Z]/g, "").length);
                    allMessages.push({
                        message: message,
                        spam: ["b", "c"].includes(data[message]),
                        tokensWeight: findChatWeighting(messageTokens).toFixed(3),
                        metaWeight: findChatWeighting(metaTokens).toFixed(3),
                        discrimWeight: findChatWeighting(discrimTokens).toFixed(3)
                    });
                    console.log("Finished", message);
                }
                for (message of allMessages) {
                    document.querySelector("table").innerHTML += `
                        <tr>
                            <td>${message.message}</td>
                            <td>${message.spam ? "spam" : "fine"}</td>
                            <td>${message.tokensWeight}</td>
                            <td>${message.metaWeight}</td>
                            <td>${message.discrimWeight}</td>
                        </tr>
                    `;
                }
            });
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MP1009LM4F"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-MP1009LM4F');
    </script>
</body>
</html>
